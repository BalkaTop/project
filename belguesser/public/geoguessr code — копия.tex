<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Google Panorama</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-color: #f4f4f9;
        }

        #map-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 300px;
            height: 300px;
            border: 2px solid #000;
            border-radius: 8px;
            background-color: #fff;
            z-index: 2;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #button-container {
            position: absolute;
            top: 330px;
            right: 26px;
            z-index: 2;
        }

        #calculate-distance {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 30px;
            width: 270px;
            cursor: pointer;
        }

        #calculate-distance:hover {
            background-color: #66CDAA;
        }

        #popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
            text-align: center;
        }

        #popup h2 {
            margin: 0 0 10px;
        }

        #popup button {
            padding: 10px 20px;
            font-size: 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        #popup button:hover {
            background-color: #66CDAA;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        #panorama {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGbr_QILBhKjlGn5KywwhRM4qZEYR3vXk&libraries=geometry"></script>
</head>
<body>
    <div id="map-container"></div>
    <div id="button-container">
        <button id="calculate-distance">Guess!</button>
    </div>
    <div id="panorama"></div>

    <div id="popup">
        <h2>Your Score: <span id="score"></span></h2>
        <p>The actual location was <span id="location-name"></span>.</p>
		<p>The distance is <span id = 'distanceInKm'></span>km.</p>
        <button onclick="closePopup()">Close</button>
    </div>
    <div id="overlay"></div>

    <script>
        let panorama, map, marker;
        let panoramaLocation;
        const knownLocations = [
            { lat: 48.858844, lng: 2.294351, name: 'Eiffel Tower' },
            { lat: 40.689247, lng: -74.044502, name: 'Statue of Liberty' }, 
            { lat: 27.175015, lng: 78.042155, name: 'Taj Mahal' },
            { lat: -33.856784, lng: 151.215297, name: 'Sydney Opera House' },
            { lat: 51.500729, lng: -0.124625, name: 'Big Ben' },
            { lat: 35.658581, lng: 139.745438, name: 'Tokyo Tower' },
            { lat: 55.752121, lng: 37.617664, name: 'Red Square, Moscow' },
            { lat: -22.951916, lng: -43.210487, name: 'Christ the Redeemer' },
            { lat: 37.819929, lng: -122.478255, name: 'Golden Gate Bridge' },
            { lat: 43.723, lng: 10.3966, name: 'Leaning Tower of Pisa' },
            { lat: 30.328611, lng: 35.441944, name: 'Petra, Jordan' },
            { lat: 25.197197, lng: 55.274376, name: 'Burj Khalifa' },
            { lat: -13.163068, lng: -72.545128, name: 'Machu Picchu' },
            { lat: 41.890251, lng: 12.492373, name: 'Colosseum' },
            { lat: -17.924, lng: 25.857, name: 'Victoria Falls' },
        ];

        function getRandomLocation() {
            const randomIndex = Math.floor(Math.random() * knownLocations.length);
            return knownLocations[randomIndex];
        }

        function initPanorama() {
            const randomLocation = getRandomLocation();
            panoramaLocation = randomLocation;

            if (panorama) {
                panorama.setPosition(randomLocation);
            } else {
                panorama = new google.maps.StreetViewPanorama(
                    document.getElementById("panorama"),
                    {
                        position: randomLocation,
                        pov: {
                            heading: 34,
                            pitch: 10,
                        },
                        zoom: 1,
                        disableDefaultUI: true,
                        addressControl: false,
                    }
                );
            }
        }

        function initMap() {
            map = new google.maps.Map(document.getElementById("map-container"), {
                center: { lat: 0, lng: 0 },
                zoom: 2,
            });

            map.addListener("click", (event) => {
                if (marker) marker.setMap(null);
                marker = new google.maps.Marker({
                    position: event.latLng,
                    map: map,
                });
            });
        }

        function calculateDistance() {
            if (!marker) {
                alert("Please place a marker on the map.");
                return;
            }

            const markerPosition = marker.getPosition();
            const distance = google.maps.geometry.spherical.computeDistanceBetween(
                new google.maps.LatLng(panoramaLocation),
                markerPosition
            ) / 1000; // Convert to kilometers
			const distanceInKm = distance.toFixed(2);

            const maxDistance = 20000; // Approximate radius of Earth in km
            const score = Math.max(0, 5000 * (1 - Math.log(distance + 1) / Math.log(maxDistance + 1)));

            document.getElementById("score").innerText = Math.round(score);
            document.getElementById("location-name").innerText = panoramaLocation.name;
			document.getElementById("distanceInKm").innerText = distanceInKm;

            openPopup();
            resetMap();
        }

        function openPopup() {
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        function closePopup() {
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
			initPanorama();
			
        }

        function resetMap() {
            if (marker) {
                marker.setMap(null);
                marker = null;
            }
        }

        document.getElementById("calculate-distance").addEventListener("click", calculateDistance);

        window.onload = function () {
            initPanorama();
            initMap();
        };
    </script>
</body>
</html>
